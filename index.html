<!DOCTYPE html>
<html lang="ko-KR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <h1 class="title">LiveCHAT</h1>
        <p class="menu">초기화</p>
    </header>
    <main>
        <div class="container">
            <div class="chat_view">
                <div class="chatgpt">챗 GPT 채팅입니다.</div>
                <div class="user">유저 채팅입니다.</div>
                <div class="chatgpt">챗 GPT 채팅입니다.</div>
                <div class="user">유저 채팅입니다.</div>
                <div class="chatgpt">챗 GPT 채팅입니다.</div>
                <div class="user">유저 채팅입니다.</div>
                <div class="chatgpt">챗 GPT 채팅입니다.</div>
                <div class="user">유저 채팅입니다.</div>
                <div class="chatgpt">챗 GPT 채팅입니다.</div>
                <div class="user">유저 채팅입니다.</div>
                <div class="chatgpt">챗 GPT 채팅입니다.</div>
                <div class="user">유저 채팅입니다.</div>
                <div class="chatgpt">Lorem ipsum dolor sit amet consectetur adipisicing elit. Fugiat quas, nam dicta,
                    itaque placeat dolorum dignissimos quis porro tempora excepturi doloremque nesciunt enim quam
                    pariatur amet aspernatur eum, iste eveniet?</div>
                <div class="user">Lorem ipsum dolor sit amet consectetur, adipisicing elit. Quod maxime in laboriosam
                    ullam eos minima porro tempora, expedita commodi ab autem temporibus maiores. Quia, similique
                    inventore? Ullam quos beatae perspiciatis.</div>
            </div>
            <div>
                <form class="chating"><textarea name="chat" cols="30" rows="10">채팅창입니다</textarea>
                    <button type="submit">입력</button>
                </form>
            </div>
        </div>
    </main>
    <footer>
        copyright 2023. All right reserved
    </footer>
</body>
<script>
    const $textarea = document.querySelector('textarea');
    const $button = document.querySelector('button');
    const $answer = document.querySelector('.chatgpt');
    const url = `https://estsoft-openai-api.jejucodingcamp.workers.dev/`;
    const data = []
    data.push({
        "role": "system",
        "content": "assistant는 운동 루틴을 추천해주는 트레이너입니다."
    })

    $button.addEventListener('click', e => {
        e.preventDefault()
        const contents = $textarea.value
        data.push({
            "role": "user",
            "content": contents
        })
        $textarea.value = ''

        chatGPTAPI()
    })

    function chatGPTAPI() {
        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data),
            redirect: 'follow'
        })
            .then(res => res.json())
            .then(res => {
                console.log(res)
                // 답변 온 것을 assistant로 저장
                $answer.innerHTML = `<p>${res.choices[0].message.content}</p>`
            })
    }
</script>

</html>